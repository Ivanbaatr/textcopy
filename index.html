<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOL 성구 복사기</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 'Inter' 폰트 사용 */
        :root {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 flex items-center justify-center">

    <div id="app" class="bg-white p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-lg space-y-6">
        <h1 class="text-3xl font-extrabold text-gray-900 text-center border-b pb-3 mb-4">
            WOL 성구 복사기
        </h1>
        
        <!-- 고정된 규칙 안내 -->
        <div class="p-3 bg-red-50 border-l-4 border-red-500 rounded-lg shadow-sm hidden">
            <p class="text-sm font-semibold text-red-700">
                자동 제거 및 치환 규칙:
            </p>
            <ul class="text-sm text-gray-700 list-disc list-inside ml-2 mt-1">
                <li>**연속된 '+'** 문자 제거</li>
                <li>**'신세계역 성경 (연구용)'** 문구를 **')'** 하나로 치환 (주변 공백 정리 및 **치환 후 문자 2개 추가 제거**)</li>
                <li>**"숫자, 공백, 숫자"** 패턴에서 공백 제거 (예: `1, 234` → `1,234`)</li>
                <li>**줄 시작에 오는 성경 책 이름 앞**에 **'('** 삽입</li>
            </ul>
        </div>
        
        <!-- 1. 입력 영역 -->
        <div>
            <label for="input-text" class="block text-sm font-medium text-gray-700 mb-2">
                원본 텍스트 (여기에 붙여넣으세요)
            </label>
            <textarea id="input-text" rows="8" placeholder="여기에 텍스트를 붙여넣으면 자동으로 정리됩니다."
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 shadow-inner"></textarea>
        </div>

        <!-- 2. 결과 영역 -->
        <div>
            <label for="output-text" class="block text-sm font-medium text-gray-700 mb-2">
                정리된 텍스트
            </label>
            <textarea id="output-text" rows="8" readonly
                class="w-full p-3 border border-gray-300 bg-gray-50 rounded-lg text-gray-800 transition duration-150 font-mono"></textarea>
        </div>

        <!-- 3. 버튼 및 메시지 영역 -->
        <div class="flex flex-col sm:flex-row sm:justify-between items-center gap-4 pt-2">
            <button id="copy-button"
                class="w-full sm:w-auto px-6 py-3 bg-indigo-600 text-white font-semibold rounded-full shadow-lg hover:bg-indigo-700 transition duration-200 transform hover:scale-105 active:scale-95 disabled:bg-indigo-300 disabled:cursor-not-allowed">
                정리하고 복사하기
            </button>
            <span id="message" class="text-sm font-medium text-green-600 opacity-0 transition duration-300"></span>
        </div>
    </div>

    <script>
        // DOM 요소 참조
        const inputTextarea = document.getElementById('input-text');
        const outputTextarea = document.getElementById('output-text');
        const copyButton = document.getElementById('copy-button');
        const messageSpan = document.getElementById('message');
        
        const apiKey = "" // API 키를 여기에 넣을 수 있습니다. 현재는 사용하지 않습니다.

        // 성경의 책 이름 전체 목록 (정규식 생성을 위해 배열로 저장)
        const BIBLE_BOOKS = [
            '창세기', '출애굽기', '레위기', '민수기', '신명기', '여호수아', '사사기', '룻기', 
            '사무엘상', '사무엘하', '열왕기상', '열왕기하', '역대상', '역대하', '에스라', '느헤미야', 
            '에스더', '욥기', '시편', '잠언', '전도서', '아가', '이사야', '예레미야', '애가', 
            '에스겔', '다니엘', '호세아', '요엘', '아모스', '오바댜', '요나', '미가', '나훔', 
            '하박국', '스바냐', '학개', '스가랴', '말라기', '마태복음', '마가복음', '누가복음', 
            '요한복음', '사도행전', '로마서', '고린도 전서', '고린도 후서', '갈라디아서', '에베소서', 
            '빌립보서', '골로새서', '데살로니가 전서', '데살로니가 후서', '디모데 전서', '디모데 후서', 
            '디도서', '빌레몬서', '히브리서', '야고보서', '베드로 전서', '베드로 후서', 
            '요한 1서', '요한 2서', '요한 3서', '유다서', '요한 계시록'
        ].sort((a, b) => b.length - a.length); // 길이가 긴 단어를 먼저 처리하도록 정렬합니다.


        /**
         * 텍스트에서 고정된 규칙을 적용하여 정리합니다.
         */
        function cleanText() {
            let cleanedText = inputTextarea.value;
            
            // 1. 연속된 '+' 문자를 제거합니다.
            cleanedText = cleanedText.replace(/\++/g, '');
            
            // 2. '신세계역 성경 (연구용)' 문구를 찾아 ')' 하나로 치환하고 주변 공백을 제거하며, 그 뒤의 문자 2개를 제거합니다.
            const phraseToTarget = "신세계역 성경 (연구용)";
            const escapedPhrase = phraseToTarget.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const phraseRegex = new RegExp(`[\\s\\r\\n]*${escapedPhrase}[\\s\\r\\n]*.{0,2}`, 'g');
            cleanedText = cleanedText.replace(phraseRegex, ')');

            // 3. 숫자, 쉼표, 공백, 숫자 패턴에서 공백을 제거합니다. (예: 1, 000 -> 1,000)
            cleanedText = cleanedText.replace(/(\d+),\s+(\d+)/g, '$1,$2');
            
            // 4. (NEW RULE) 줄 바꿈 문자(\n) 바로 뒤에 성경 책 이름이 오면 그 앞에 '('를 삽입합니다.
            // 정규식 생성: (\n)(책이름1|책이름2|...)
            const bookNamesRegex = BIBLE_BOOKS.map(name => name.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|');
            // (\n)은 첫 번째 캡처 그룹($1), 성경 책 이름은 두 번째 캡처 그룹($2)입니다.
            const bookRegex = new RegExp(`(\\n)(${bookNamesRegex})`, 'g');
            
            // 치환: 줄 바꿈 문자, 여는 괄호, 책 이름 ($1, '(', $2)
            cleanedText = cleanedText.replace(bookRegex, '$1($2');

            // 5. 텍스트가 '창세기' 등으로 시작하는 경우 (맨 첫 줄)에도 괄호를 추가합니다.
            const firstBookRegex = new RegExp(`^(${bookNamesRegex})`);
            cleanedText = cleanedText.replace(firstBookRegex, '($1');


            // 6. 최종적으로 정리된 텍스트의 앞뒤 공백을 제거합니다. 
            outputTextarea.value = cleanedText.trim(); 

            // 출력 텍스트 상태에 따라 복사 버튼을 활성화/비활성화합니다.
            if (cleanedText.trim().length > 0) {
                copyButton.disabled = false;
            } else {
                copyButton.disabled = true;
            }
        }

        /**
         * 정리된 텍스트를 클립보드에 복사하고 성공 메시지를 표시합니다.
         */
        function copyToClipboard() {
            const textToCopy = outputTextarea.value;

            if (textToCopy.trim() === "") {
                return; // 텍스트가 없으면 복사하지 않습니다.
            }
            
            try {
                // 텍스트를 클립보드에 복사합니다.
                outputTextarea.select();
                outputTextarea.setSelectionRange(0, 99999); 
                document.execCommand('copy');
                
                // 성공 메시지 표시
                messageSpan.textContent = '복사 완료! (클립보드에 저장됨)';
                messageSpan.classList.remove('opacity-0', 'text-red-600');
                messageSpan.classList.add('opacity-100', 'text-green-600');

                // 2초 후 메시지 숨기기 및 초기화
                setTimeout(() => {
                    messageSpan.classList.remove('opacity-100');
                    messageSpan.classList.add('opacity-0');
                    messageSpan.textContent = '';
                    
                    // --- 복사 후 초기화 기능 ---
                    inputTextarea.value = '';
                    outputTextarea.value = '';
                    copyButton.disabled = true;
                    // ----------------------------------------

                }, 2000);

            } catch (err) {
                console.error('클립보드 복사 실패:', err);
                messageSpan.textContent = '복사 실패: 콘솔 확인';
                messageSpan.classList.remove('opacity-0', 'text-green-600');
                messageSpan.classList.add('opacity-100', 'text-red-600');
            }
        }

        // --- 이벤트 리스너 설정 ---

        // 입력 텍스트 영역에 내용이 바뀔 때마다 텍스트를 정리합니다.
        inputTextarea.addEventListener('input', cleanText);

        // 버튼 클릭 시 텍스트를 복사합니다.
        copyButton.addEventListener('click', copyToClipboard);

        // 초기 상태 설정
        copyButton.disabled = true; 
        cleanText(); 

    </script>
</body>
</html>
